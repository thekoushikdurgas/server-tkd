<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="../../public/favicon/favicon.ico" />
  <meta name="description" content="Web site created using create-react-app" />
  <link rel="manifest" href="../../public/favicon/manifest.json" />
  <link rel="android-chrome" sizes="192x192" href="../../public/favicon/android-chrome-192x192.png">
  <link rel="android-chrome" sizes="512x512" href="../../public/favicon/android-chrome-512x512.png">
  <link rel="apple-touch-icon" href="../../public/favicon/apple-touch-icon.png">
  <link rel="icon" sizes="16x16" href="../../public/favicon/favicon.ico" />
  <link rel="icon" sizes="32x32" href="../../public/favicon/favicon.ico" />
  <meta name="msapplication-TileColor" content="#fe6100">
  <meta name="theme-color" content="#2c0101">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/flaticon.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/pro.min.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/uicons.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/bootstrap-icons.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/ionicons.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/cartzillaicons.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/glyphicons.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/socicon.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/nebular.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/curiositystream.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/openiconic.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/boxicons.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/eva icons.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/icomoon2.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/icomoon3.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/icomoon4.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/iconmonstriconicfont.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/uxwingiconsfont.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/tablericons.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/simplelineicons.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/remixicon.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/pixelvicon.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/brooksfonts.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/hawcons.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/feather.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/coreui_icons.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/appliancesicons.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/thekoushikdurgas.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/weathericon.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/customicons.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/weather-icons-wind.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/learnnet.css">
  <link rel="stylesheet" href="https://thekoushikdurgas.github.io/TKDstroage/css/iconscout.css">
  <link rel="stylesheet" href="../../public/css/app.css">
  <title>Network of Tools</title>
</head>

<body class="bodydark">
  <div class="background"></div>
  <div class="sun" id="sun">
    <div class="sun-anime">
      <div class="sun-ball"></div>
      <div class="sun-light"><b></b><s></s></div>
      <div class="sun-light"><b></b><s></s></div>
      <div class="sun-light"><b></b><s></s></div>
      <div class="sun-light"><b></b><s></s></div>
      <div class="sun-light"><b></b><s></s></div>
      <div class="sun-light"><b></b><s></s></div>
      <div class="sun-light"><b></b><s></s></div>
      <div class="sun-light"><b></b><s></s></div>
      <div class="sun-light"><b></b><s></s></div>
      <div class="sun-light"><b></b><s></s></div>
      <div class="sun-light"><b></b><s></s></div>
      <div class="sun-light"><b></b><s></s></div>
    </div>
  </div>
  <div class="moon" id="moon">
    <div class="shadow" id="moonshadow"></div>
    <div class="light" id="moonlight"></div>
  </div>
  <div class="app">
    <div class="header">
      <div class="tkdhome" onclick="location.assign('../../');">
        <svg version="1.1" class="icon icon_house" viewBox="-11 -11 70 70" xml:space="preserve">
          <g class="iconGroup iconGroup_wrap">
            <circle class="iconComponent_smoke iconComponent_smoke1" cx="42" cy="5.333" r="2.333" />
            <circle class="iconComponent_smoke iconComponent_smoke2" cx="42" cy="6" r="3" />
            <circle class="iconComponent_smoke iconComponent_smoke3" cx="42" cy="5.333" r="2.25" />
            <polygon class="iconComponent_chimney" points="39,3 45,3 45,16.017 39,9.159 " />
            <polygon class="iconComponent_roof" points="42,24 24,3.432 6,24 0,24 21,0 27,0 48,24 " />
            <polygon class="iconComponent_body"
              points="41.997,27.873 24,7.983 6,27.873 6,48 18,48 30,48 42,48 42,27.876 42,27.873 " />
            <rect class="iconComponent_window iconComponent_window-left" x="11.167" y="29.5" width="8.667"
              height="8.667" />
            <rect class="iconComponent_window iconComponent_window-right" x="28" y="29.5" width="8.667"
              height="8.667" />
          </g>
        </svg>
      </div>
      <!-- <div class="search-bar">
        <input type="text" placeholder="Search">
      </div> -->
      <div class="dz-fullscreen fullscreen" id="fullscreenicon" onclick="showfullscreen();">
        <svg class="fs-icon" xmlns="http://www.w3.org/2000/svg" xmlnsXlink="http://www.w3.org/1999/xlink" version="1.1"
          x="0px" y="0px" viewBox="0 0 100 100" enableBackground="new 0 0 100 100" xmlSpace="preserve">
          <path class="tr arrow"
            d="M74.6 33.6l0-4.3L63.2 40.7c-1.1 1.1-2.8 1.1-3.8 0c-1.1-1.1-1.1-2.8 0-3.9l11.4-11.4h-4.3 c-1.5 0-2.7-1.2-2.7-2.7c0-1.5 1.2-2.7 2.7-2.7h10.9c1.5 0 2.7 1.2 2.7 2.7v10.9c0 1.5-1.2 2.7-2.7 2.7 C75.8 36.3 74.6 35.1 74.6 33.6z" />
          <path class="tl arrow"
            d="M33.6 25.4h-4.3l11.4 11.4c1.1 1.1 1.1 2.8 0 3.8c-1.1 1.1-2.8 1.1-3.8 0L25.4 29.3v4.3 c0 1.5-1.2 2.7-2.7 2.7c-1.5 0-2.7-1.2-2.7-2.7V22.7c0-1.5 1.2-2.7 2.7-2.7l10.9 0c1.5 0 2.7 1.2 2.7 2.7 C36.3 24.2 35.1 25.4 33.6 25.4z" />
          <path class="bl arrow"
            d="M25.4 66.4l0 4.3l11.4-11.4c1.1-1.1 2.8-1.1 3.8 0c1.1 1.1 1.1 2.8 0 3.9L29.3 74.6h4.3 c1.5 0 2.7 1.2 2.7 2.7c0 1.5-1.2 2.7-2.7 2.7H22.7c-1.5 0-2.7-1.2-2.7-2.7V66.4c0-1.5 1.2-2.7 2.7-2.7 C24.2 63.7 25.4 64.9 25.4 66.4z" />
          <path class="br arrow"
            d="M66.4 74.6h4.3L59.3 63.2c-1.1-1.1-1.1-2.8 0-3.8c1.1-1.1 2.8-1.1 3.8 0l11.4 11.4v-4.3 c0-1.5 1.2-2.7 2.7-2.7c1.5 0 2.7 1.2 2.7 2.7v10.9c0 1.5-1.2 2.7-2.7 2.7l-10.9 0c-1.5 0-2.7-1.2-2.7-2.7 C63.7 75.8 64.9 74.6 66.4 74.6z" />
        </svg>
      </div>
    </div>
    <div class="wrapper">
      <div class="main-container">
        <div class="content-wrapper">
          <div class="cardboxs" id="contentsection1">
            <div class="cardbox">
              <div class="cardbox-title">
                <div class="cardbox-products">
                  <i id="headericon"></i>
                  <span id="header"></span>
                </div>
              </div>
              <div id="modal" class="modal">
                <div class="modal-content">
                  <span class="close-button" id="close-button" onclick="closeModal()"><i class="tkd3-close"></i></span>
                  <h2>Add/Edit Data</h2>
                  <form id="data-form">
                    <input type="hidden" id="data-id" value="">
                  </form>
                </div>
              </div>
              <div id="delete-confirmation-modal" class="modal">
                <div class="modal-content">
                  <h2>Delete Confirmation</h2>
                  <p>Are you sure you want to delete this record?</p>
                  <button id="confirm-delete-button">Confirm Delete</button>
                  <button id="cancel-delete-button" onclick="closeDeleteConfirmation()">Cancel</button>
                </div>
              </div>
              <div class="cardbox-table">
                <button id="add-button" title="new button" onclick="openModal()"><i class="tkd2-plus"></i></button>
                <table class="myTable" id="data-table">
                  <thead>
                    <tr id="tableheader"></tr>
                  </thead>
                  <tbody id="tableBody"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        <!-- <div class="main-header">
          <div class="header-menu">
            <a class="main-header-link is-active" href="#">Desktop</a>
            <a class="main-header-link" href="#">Mobile</a>
            <a class="main-header-link" href="#">Web</a>
          </div>
        </div> -->
      </div>
    </div>
    <div class="overlay-app"></div>
  </div>
  <script src='../../public/js/jquery.min.js'></script>
  <script src="../../public/js/demo.js"></script>
  <script src='../../public/js/suncalc.js'></script>
  <script src="../../public/js/app.js"></script>
  <script>
    let data = [];
    let tableheaders = [];
    let tableheadertypes = [];
    let editingId = null;
    let deletingId = null;
    let apiUrl = '';
    const tableheader = document.querySelector("#tableheader");
    const tableBody = document.querySelector("#tableBody");
    const dataform = document.querySelector("#data-form");
    const modal = document.querySelector("#modal");
    const confirmdeletebutton = document.querySelector("#confirm-delete-button");
    const datatable = document.querySelector("#data-table");
    const deleteConfirmationModal = document.querySelector("#delete-confirmation-modal");

    async function fetchData() {
      try {
        var urlParams = new URLSearchParams(window.location.search);
        var serializedArray = urlParams.get('data');
        if (serializedArray) {
          var myJSON = JSON.parse(decodeURIComponent(serializedArray));
          document.getElementById('headericon').classList.add(myJSON.icon);
          document.getElementById('header').innerHTML = myJSON.head;
          myJSON.values.forEach(function (item) {
            var listItem = document.createElement('th');
            listItem.textContent = item.name;
            tableheader.appendChild(listItem);
            const label = document.createElement('label');
            label.textContent = item.name + ': ';
            const input = document.createElement('input');
            input.type = 'text';
            input.name = item.name.toLowerCase().replace(' ', '_');
            input.id = item.name.toLowerCase().replace(' ', '_');
            dataform.appendChild(label);
            dataform.appendChild(input);
            tableheaders.push(item.name);
            tableheadertypes.push(item.type);
          });
          var listItem = document.createElement('th');
          listItem.textContent = 'Action';
          tableheader.appendChild(listItem);
          var label = document.createElement('button');
          label.textContent = 'Save';
          label.type = 'submit';
          dataform.appendChild(label);
          apiUrl = `../../${myJSON.link}`;
          const response = await fetch(apiUrl);
          data = await response.json();
          populateTable();
        }
      } catch (error) {
        console.error('Error fetching data:', error);
      }
    }
    function populateTable() {
      tableBody.innerHTML = '';
      data.forEach((item) => {
        const row = document.createElement("tr");
        var rowinnerHTML = "";
        for (let i = 0; i < tableheaders.length; i++) {
          if (tableheadertypes[i] == 'Array') {
            rowinnerHTML += `<td>`
            item[tableheaders[i]].forEach((element) => {
              rowinnerHTML += `<span>${element}</span><br/>`
            });
            rowinnerHTML += `</td>`
          } else if (tableheadertypes[i] == 'Image') {
            rowinnerHTML += `<td><img src="${item[tableheaders[i]]}" alt=""/></td>`
          } else if (tableheadertypes[i] == 'Icon') {
            rowinnerHTML += `<td><i class="${item[tableheaders[i]]}"></i></td>`
          } else if (tableheadertypes[i] == 'Link') {
            rowinnerHTML += `<td><a href="${item[tableheaders[i]]}">Link</a></td>`
          } else {
            rowinnerHTML += `<td>${item[tableheaders[i]]}</td>`
          }
        }
        rowinnerHTML += `<td class="actions"><button class="edit-button" onclick="openModal('${item._id}')"><i class="tkd8-edit"></i></button><button class="delete-button" onclick="openDeleteConfirmation('${item._id}')"><i class="tkd10-recycle-bin-line"></i></button></td>`;
        row.innerHTML = rowinnerHTML;
        tableBody.appendChild(row);
      });
    }
    function openModal(id) {
      modal.style.display = "block";
      if (id) {
        editingId = id;
        const item = data.find((d) => d._id === id);
        document.querySelector("#data-id").value = item._id;
        for (let i = 0; i < tableheaders.length; i++) {
          document.querySelector(`#${tableheaders[i].toLowerCase().replace(' ', '_')}`).value = item[tableheaders[i]];
        }
      } else {
        editingId = null;
        document.querySelector("#data-id").value = '';
        for (let i = 0; i < tableheaders.length; i++) {
          document.querySelector(`#${tableheaders[i].toLowerCase().replace(' ', '_')}`).value = '';
        }
      }
    }
    function openDeleteConfirmation(id) {
      deletingId = id;
      deleteConfirmationModal.style.display = "block";
    }
    function closeDeleteConfirmation() {
      deletingId = null;
      deleteConfirmationModal.style.display = "none";
    }
    function closeModal() {
      modal.style.display = "none";
    }
    dataform.onsubmit = async (e) => {
      e.preventDefault();
      var tempjson = {}
      for (let i = 0; i < tableheaders.length; i++) {
        tempjson[tableheaders[i]] = document.querySelector(`#${tableheaders[i].toLowerCase().replace(' ', '_')}`).value;
      }
      if (editingId !== null) {
        fetch(`${apiUrl}${editingId}`, { method: 'POST', headers: { 'Content-Type': 'application/json', }, body: JSON.stringify(tempjson), }).then((response) => { return response.json(); }).then((createdData) => {
          if (createdData.success) {
            console.log('Record updated:', createdData);
            const index = data.findIndex((d) => d._id === editingId);
            data[index] = createdData.updatedUser;
            populateTable();
            closeModal();
          }
        }).catch((error) => { console.error('Error creating data:', error); });
      } else {
        fetch(`${apiUrl}add`, { method: 'POST', headers: { 'Content-Type': 'application/json', }, body: JSON.stringify(tempjson), }).then((response) => { return response.json(); }).then((createdData) => {
          if (createdData.success) {
            console.log('Record created:', createdData);
            data.push(createdData.temp);
            populateTable();
            closeModal();
          }
          console.log(`${apiUrl}add`);
        }).catch((error) => { console.error('Error creating data:', error); });
      }
    }
    confirmdeletebutton.onclick = async (e) => {
      e.preventDefault();
      if (deletingId !== null) {
        fetch(`${apiUrl}${deletingId}`, { method: 'DELETE', headers: { 'Content-Type': 'application/json', }, }).then((response) => { return response.json(); }).then((createdData) => {
          if (createdData.success) {
            data = data.filter((d) => d._id !== deletingId);
            populateTable();
            closeDeleteConfirmation();
          }
        }).catch((error) => { console.error('Error deleting data:', error); });
      }
    }
    fetchData();
  </script>
</body>

</html>